# Maintainer: Jacek Swierk <jacek.swierk@protonmail.com>

pkgname=p4merge-bin
_pkgname=p4v
pkgver=18.2
pkgrel=1
pkgdesc="Three-way merging and side-by-side file comparison tool (official binary version)"
arch=("x86_64")
url="https://www.perforce.com/downloads/visual-merge-tool"
license=("custom: commercial")
depends=("qt5-base")
provides=("p4merge")
replaces=("p4merge")
conflicts=("p4merge")
source=("https://cdist2.perforce.com/perforce/r${pkgver}/bin.linux26x86_64/${_pkgname}.tgz")
noextract=("${_pkgname}.tgz")
sha256sums=("9b1da4f908f24b17d3fb4e8aa6ea7ede6fd72f93d6964a8c3e3704e0fd40f114")

prepare() {
    cd "${srcdir}"
    mkdir -p "${srcdir}/${_pkgname}"
    tar -xf ${_pkgname}.tgz --strip-components=1 -C "${srcdir}/${_pkgname}"
}

package() {
    install -d "${pkgdir}/opt/${_pkgname}"
    install -d "${pkgdir}/usr/bin"
    cp -r "${srcdir}/${_pkgname}/"* "${pkgdir}/opt/${_pkgname}" -R
    ln -sfn "/opt/${_pkgname}/bin/p4merge" "${pkgdir}/usr/bin/p4merge"
}
